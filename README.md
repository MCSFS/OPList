# OPGuard - 智能OP权限守护插件

![Minecraft](https://img.shields.io/badge/Minecraft-1.21-blueviolet?style=flat-square)
![Spigot](https://img.shields.io/badge/Spigot-API%207.0%2B-yellow?style=flat-square)

## 插件概述

一个智能的OP权限监控系统，实时检测服务器中的OP权限变动。当检测到未授权的玩家获取OP权限时，将自动执行以下操作：
1. 立即撤销非法OP权限
2. 执行预设的封禁命令
3. 向全服玩家发送警示广播
4. 记录安全事件到控制台

## 主要功能

- 🛡️ 实时OP权限监控
- ⚡ 自动执行安全措施
- 📢 可视化警报通知
- 🔧 高度可定制化配置
- 📅 支持全版本现代Minecraft服务端

## 配置文件详解 (`config.yml`)

```yaml
# 允许保留OP的玩家名单
allowed_ops:
  - 'trusted_admin'

# 当发现非法OP时执行的自定义命令（可用 {player} 作为占位符）
custom_command: 'ban {player} 非法获取管理员权限'

# 封禁后的广播消息（可用 {player} 作为占位符）
broadcast_message: '&c玩家 &6{player} &c因非法获取OP权限已被封禁！'
```

### 配置项说明

#### 1. 授权名单配置
```yaml
allowed_ops:
  - 'trusted_admin'
```
| 属性        | 说明                                                                 |
|-------------|--------------------------------------------------------------------|
| **功能**    | 白名单系统，定义允许拥有OP权限的玩家                                     |
| **格式**    | YAML列表格式                                                         |
| **注意事项** | • 严格区分大小写<br>• 使用单引号包裹玩家名<br>• 每个ID独占一行并以短横线开头 |
| **示例**    | `- 'AdminSteve'` 表示允许玩家AdminSteve持有OP权限                       |

#### 2. 自定义命令配置
```yaml
custom_command: 'ban {player} 非法获取管理员权限'
```
| 属性        | 说明                                                                 |
|-------------|--------------------------------------------------------------------|
| **功能**    | 定义检测到非法OP时执行的命令                                             |
| **占位符**  | `{player}` 自动替换为违规玩家名称                                        |
| **扩展应用**| 可配置为其他处罚命令，如：<br>`essentials:jail {player} 24h 安全审查`      |
| **权限需求**| 确保插件拥有执行目标命令的权限                                            |

#### 3. 广播消息配置
```yaml
broadcast_message: '&c玩家 &6{player} &c因非法获取OP权限已被封禁！'
```
| 属性         | 说明                                                                 |
|--------------|--------------------------------------------------------------------|
| **功能**     | 定义全服广播的消息内容                                                  |
| **颜色代码** | 支持`&`符号的十六进制颜色代码（需客户端支持）                                |
| **占位符**   | `{player}` 自动替换为违规玩家名称                                        |
| **排版建议** | 使用颜色代码分段强调关键信息，例如：<br>`&c[警报] &6{player} &e已被系统自动封禁` |

## 安装指南

1. 下载最新版本插件
2. 将jar文件放入服务器的`plugins/`目录
3. 重启服务器生成配置文件
4. 编辑`plugins/OPGuard/config.yml`进行配置
5. 重载配置文件或重启服务器生效

## 注意事项

**⚠️ 权限需求**  
确保插件拥有以下权限：
- `bukkit.command.op` （撤销OP权限）
- `bukkit.command.ban` （执行封禁命令）

**🎨 颜色代码**  
广播消息支持的颜色代码示例：
- `&4` 深红
- `&c` 红色
- `&6` 金色
- `&e` 黄色
- `&a` 绿色

**📜 日志追踪**  
所有安全事件都会在控制台记录，格式：  
`[OPGuard] 检测到未授权OP：<玩家名> 已执行安全协议`

**🔧 高级配置**  
可通过修改`custom_command`实现：
- 执行多重命令
- 调用其他插件API
- 记录到数据库
- 发送Webhook通知
